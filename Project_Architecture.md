# 智题坊项目架构与功能实现逻辑

## 1. 项目概述

智题坊是一个功能完善的智能答题系统，旨在提供题库管理、智能组卷、在线答题及 AI 辅助出题等核心功能。项目采用双端架构设计：

* **桌面原生端**：基于 PySide6 构建，提供流畅的本地操作体验。
* **Web 网页端**：基于 FastAPI (后端) + Vue 3 (前端) 构建，支持现代化的 Web 交互。

## 2. 技术栈

| 维度 | 技术选型 |
| :--- | :--- |
| **后端语言** | Python 3.10+ |
| **Web 框架** | FastAPI (异步高性能) |
| **前端框架** | Vue 3 (Composition API) |
| **UI 组件库** | Element Plus |
| **桌面框架** | PySide6 (Qt for Python) |
| **数据存储** | 本地 JSON 文件 (轻量级、易迁移) |
| **AI 集成** | OpenAI / 火山引擎 / Azure 兼容接口 |

## 3. 核心目录结构

```text
AnswerSystem/
├── main.py              # 桌面端程序入口
├── models/              # 数据模型层 (Pydantic/Class)
│   ├── bank.py          # 题库模型
│   ├── question.py      # 题目模型
│   └── paper.py         # 试卷模型
├── services/            # 核心业务逻辑层 (Service Pattern)
│   ├── ai_service.py    # AI 解析与生成逻辑
│   ├── bank_service.py  # 题库增删改查
│   └── exam_service.py  # 考试流程控制与评分
├── gui/                 # PySide6 桌面端界面代码
├── web/                 # Web 端代码
│   ├── backend/         # FastAPI 路由与控制器
│   └── frontend/        # Vue 3 前端项目
└── data/                # 数据存储目录 (JSON 文件)
```

## 4. 功能实现逻辑

### 4.1 数据持久化逻辑

系统未采用传统数据库，而是使用 **JSON 文件** 进行持久化，这使得系统具有极强的便携性。

* **元数据管理**：`banks_meta.json` 记录所有题库的索引信息（ID、名称、题目数量等）。
* **分文件存储**：每个题库对应一个独立的 JSON 文件（如 `bank_uuid.json`），避免单个文件过大影响性能。
* **自动同步**：`BankService` 在执行增删改操作后，会同步更新内存对象、物理文件及元数据索引。

### 4.2 AI 智能导入与生成

AI 功能是本系统的核心亮点，通过 `AIService` 实现：

1. **文本解析**：用户输入一段杂乱的题目文本，AI 通过 Prompt 指引将其解析为标准的 JSON 结构（包含题干、选项、答案、解析）。
2. **文件解析**：支持 Word/PDF/图片。系统先提取文本内容，再交由 AI 进行结构化处理。
3. **智能出题**：根据用户提供的“知识点”和“难度”，AI 自动生成符合要求的题目。
4. **批量处理**：前端解析完成后，支持用户二次编辑，最后通过 `batch_add_questions` 接口一次性导入题库。

### 4.3 考试与评分系统

1. **智能组卷**：`PaperService` 根据用户设定的题型比例、难度要求，从指定题库中随机抽取题目生成试卷。
2. **答题状态管理**：Web 端使用 Vue 响应式变量记录用户答案，支持实时保存进度。
3. **自动评分**：
    * **单选/判断**：字符串精确匹配。
    * **多选**：集合匹配（需完全一致或按比例得分，取决于配置）。
    * **结果分析**：生成包含得分率、错题分布、用时统计的 `Result` 对象并持久化。

### 4.4 收藏夹逻辑

* **独立存储**：收藏信息记录在 `favorites.json` 中。
* **关联查询**：收藏记录仅保存 `question_id` 和 `bank_id`，展示时通过 `FavoriteService` 动态关联题库获取题目详情，确保数据一致性。

## 5. 关键设计模式

* **Service 模式**：将业务逻辑从 API 路由（FastAPI）和界面逻辑（PySide6）中抽离，实现逻辑复用。
* **单例模式**：各 Service 实例在应用生命周期内保持单例，确保数据缓存一致。
* **前后端分离**：Web 端采用标准的 RESTful API 交互，前端通过 Axios 封装 API 请求。

## 6. 开发与部署说明

* **环境配置**：通过 `config.py` 统一管理路径、AI 密钥等配置。
* **打包发布**：使用 `build.spec` 配合 PyInstaller，可将 Python 环境、FastAPI 服务及前端产物打包为单个 EXE 文件。
