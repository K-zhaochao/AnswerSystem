# 智能答题系统 - 需求文档

## 一、项目概述

### 1.1 项目名称

智能答题系统 (Smart Quiz System)

### 1.2 项目描述

一个基于 Python 开发的桌面智能答题系统，支持题库管理、智能组卷、本地答题和自动评分功能。系统集成 AI 能力，可通过图片或文字自动生成标准化题目。最终打包为 Windows 可执行文件（.exe）。

### 1.3 技术栈

- **开发语言**: Python 3.10+
- **GUI 框架**: PyQt6 / PySide6 / CustomTkinter（待确认）
- **数据存储**: 本地 JSON/SQLite 文件（轻量级数据库）
- **AI 接口**: OpenAI API / 其他大模型 API（待确认）
- **打包工具**: PyInstaller / Nuitka（生成 .exe 可执行文件）

### 1.4 GUI 框架对比

| 框架 | 优点 | 缺点 | 推荐场景 |
|-----|------|------|----------|
| **PyQt6/PySide6** | 功能强大、界面美观、组件丰富 | 学习曲线较陡、打包体积较大 | 复杂专业应用 |
| **CustomTkinter** | 现代化外观、轻量、易上手 | 功能相对有限 | 中小型应用 |
| **Tkinter** | Python内置、无需安装 | 界面较老旧 | 简单工具 |
| **DearPyGui** | 高性能、现代化 | 社区较小 | 数据可视化应用 |

---

## 二、功能需求

### 2.1 题库管理模块

#### 2.1.1 题库创建与管理

- [ ] 支持创建多个独立题库（类似数据库表）
- [ ] 每个题库可设置名称、描述、所属课程/科目
- [ ] 支持题库的增删改查操作
- [ ] 支持题库导入/导出功能

#### 2.1.2 题目类型支持

系统支持以下题目类型：

| 类型代码 | 题目类型 | 说明 |
|---------|---------|------|
| single | 单选题 | 有且仅有一个正确答案 |
| multiple | 多选题 | 有多个正确答案 |
| judge | 判断题 | 正确/错误二选一 |
| fill | 填空题 | 填写正确答案（可选，后续扩展） |
| essay | 简答题 | 文字作答（可选，后续扩展） |

#### 2.1.3 题目数据结构

```json
{
  "id": "uuid",
  "type": "single | multiple | judge | fill | essay",
  "question": "题目内容",
  "options": ["A. 选项1", "B. 选项2", "C. 选项3", "D. 选项4"],
  "answer": "A" | ["A", "B"] | true/false,
  "explanation": "答案解析（可选）",
  "difficulty": 1-5,
  "tags": ["标签1", "标签2"],
  "created_at": "2024-01-01 12:00:00",
  "source": "manual | ai_generated"
}
```

#### 2.1.4 题库存储结构

```
data/
├── banks/
│   ├── bank_001_数学.json
│   ├── bank_002_英语.json
│   ├── bank_003_计算机基础.json
│   └── ...
└── config/
    └── banks_meta.json  # 题库元信息
```

### 2.2 题目上传模块

#### 2.2.1 手动录入

- [ ] 表单形式录入单道题目
- [ ] 支持选择题目类型、填写选项、设置正确答案
- [ ] 支持添加答案解析

#### 2.2.2 批量导入

- [ ] 支持从 Excel/CSV 文件批量导入题目
- [ ] 支持从 Word 文档导入（按特定格式解析）
- [ ] 支持 JSON 格式批量导入
- [ ] 导入时自动识别/分类题目类型

#### 2.2.3 AI 智能生成（核心功能）

- [ ] 支持上传图片，AI 识别并转换为标准题目格式
- [ ] 支持输入文字描述，AI 自动生成题目
- [ ] AI 自动识别题目类型并分类
- [ ] 支持批量图片识别生成
- [ ] 生成后可人工审核修改

### 2.3 试卷生成模块

#### 2.3.1 组卷规则设置

- [ ] 选择目标题库（可多选）
- [ ] 设置各类型题目数量：
  - 单选题：X 道
  - 多选题：X 道
  - 判断题：X 道
- [ ] 可选：按难度筛选
- [ ] 可选：按标签筛选
- [ ] 设置试卷名称、时间限制（可选）

#### 2.3.2 随机抽题算法

- [ ] 根据设置的规则从题库随机抽取题目
- [ ] 确保不重复抽取
- [ ] 当题库题目不足时给出提示

#### 2.3.3 试卷数据结构

```json
{
  "paper_id": "uuid",
  "title": "试卷名称",
  "created_at": "创建时间",
  "time_limit": 60,
  "total_score": 100,
  "questions": [
    {
      "order": 1,
      "question_id": "题目ID",
      "score": 5,
      "type": "single"
    }
  ],
  "score_rules": {
    "single": 5,
    "multiple": 5,
    "judge": 2
  }
}
```

### 2.4 答题模块

#### 2.4.1 答题界面

- [ ] 清晰展示题目内容和选项
- [ ] 支持单选/多选/判断的交互操作
- [ ] 显示答题进度（已答/未答/总数）
- [ ] 支持标记题目（待检查）
- [ ] 支持上下题切换
- [ ] 可选：倒计时显示

#### 2.4.2 答题数据记录

- [ ] 实时保存用户答案
- [ ] 记录每道题的答题时间（可选）

### 2.5 评分与结果模块

#### 2.5.1 自动评分

- [ ] 交卷后立即自动评分
- [ ] 单选题：完全正确得分，否则不得分
- [ ] 多选题：可设置部分正确得部分分（可选）
- [ ] 判断题：完全正确得分

#### 2.5.2 结果展示

- [ ] 显示总分和得分率
- [ ] 分题型统计正确率
- [ ] 逐题展示：用户答案 vs 正确答案
- [ ] 显示答案解析
- [ ] 错题标记/收藏功能（可选）

#### 2.5.3 结果数据结构

```json
{
  "result_id": "uuid",
  "paper_id": "试卷ID",
  "user_id": "用户ID（可选）",
  "start_time": "开始时间",
  "end_time": "结束时间",
  "total_score": 100,
  "user_score": 85,
  "details": [
    {
      "question_id": "题目ID",
      "user_answer": "A",
      "correct_answer": "B",
      "is_correct": false,
      "score": 0
    }
  ]
}
```

---

## 三、AI 集成需求

### 3.1 AI 功能描述

通过调用 AI 大模型 API，实现以下功能：

#### 3.1.1 图片识别生成题目

- 用户上传包含题目的图片（如试卷照片、教材截图）
- AI 识别图片中的文字内容
- AI 将识别的内容转换为标准题目 JSON 格式
- 自动识别题目类型（单选/多选/判断）

#### 3.1.2 文字智能生成题目

- 用户输入一段知识点描述或原始题目文本
- AI 解析并格式化为标准题目结构
- AI 可根据知识点自动生成相关题目

### 3.2 AI API 配置需求

```json
{
  "api_provider": "openai | azure | 其他",
  "api_key": "用户配置的API密钥",
  "api_base_url": "API基础地址（可选）",
  "model": "gpt-4-vision-preview | gpt-4 | 其他",
  "max_tokens": 4096,
  "temperature": 0.3
}
```

### 3.3 Prompt 模板示例

```
你是一个专业的题目格式化助手。请将以下内容转换为标准的JSON格式题目。

要求：
1. 识别题目类型（single-单选题, multiple-多选题, judge-判断题）
2. 提取题目内容、选项、正确答案
3. 如果能推断出答案解析，请补充

输入内容：
{user_input}

请输出JSON格式：
{
  "type": "题目类型",
  "question": "题目内容",
  "options": ["选项列表"],
  "answer": "正确答案",
  "explanation": "解析"
}
```

---

## 四、非功能需求

### 4.1 用户体验

- 界面简洁直观，操作流程清晰
- 响应速度快，答题过程流畅
- 支持中文界面

### 4.2 数据安全

- 本地数据文件存储
- AI API Key 安全存储（不明文保存在代码中）

### 4.3 可扩展性

- 模块化设计，便于后续功能扩展
- 支持新增题目类型
- 支持更换 AI 服务提供商

---

## 五、待确认事项

> **请在开发前确认以下内容：**

### 5.1 技术选型确认

- [ ] GUI 框架选择：
  - **PyQt6/PySide6**：功能最强大，界面专业美观，适合复杂应用
  - **CustomTkinter**：现代化外观，轻量易学，打包体积小
  - 其他建议？
- [ ] 数据存储：JSON 文件 或 SQLite 数据库？

### 5.2 AI 服务确认

- [ ] 使用哪个 AI 服务提供商？（OpenAI / Azure OpenAI / 国内大模型如通义千问、文心一言等）
- [ ] 是否已有 API Key？
- [ ] 图片识别功能是否必需？（需要支持视觉的模型）

### 5.3 功能优先级

- [ ] 填空题、简答题是否在第一版实现？
- [ ] 是否需要用户登录系统？
- [ ] 是否需要错题本功能？
- [ ] 是否需要答题历史记录？

### 5.4 其他确认

- [ ] 是否需要支持 Windows 以外的系统（Mac/Linux）？
- [ ] 对软件界面风格有什么偏好？（现代简约 / 专业商务）
- [ ] 打包后的 exe 文件体积有要求吗？

---

## 六、项目结构（初步规划）

```
AnswerSystem/
├── main.py                  # 应用入口
├── config.py                # 配置管理
├── requirements.txt         # 依赖列表
├── README.md                # 项目说明
├── 需求文档.md              # 本文档
│
├── gui/                     # GUI 界面模块
│   ├── __init__.py
│   ├── main_window.py       # 主窗口
│   ├── bank_view.py         # 题库管理界面
│   ├── question_view.py     # 题目编辑界面
│   ├── paper_view.py        # 组卷界面
│   ├── exam_view.py         # 答题界面
│   ├── result_view.py       # 结果展示界面
│   ├── ai_import_view.py    # AI导入界面
│   └── components/          # 可复用组件
│       ├── question_card.py # 题目卡片组件
│       └── option_group.py  # 选项组组件
│
├── models/                  # 数据模型
│   ├── __init__.py
│   ├── question.py          # 题目模型
│   ├── bank.py              # 题库模型
│   ├── paper.py             # 试卷模型
│   └── result.py            # 答题结果模型
│
├── services/                # 业务逻辑层
│   ├── __init__.py
│   ├── bank_service.py      # 题库服务
│   ├── paper_service.py     # 组卷服务
│   ├── exam_service.py      # 答题/评分服务
│   ├── ai_service.py        # AI接口服务
│   └── import_service.py    # 导入服务（Excel/图片等）
│
├── utils/                   # 工具函数
│   ├── __init__.py
│   ├── file_handler.py      # 文件读写
│   ├── validators.py        # 数据验证
│   └── helpers.py           # 辅助函数
│
├── data/                    # 数据存储目录
│   ├── banks/               # 题库文件
│   ├── papers/              # 试卷文件
│   ├── results/             # 答题记录
│   └── config.json          # 用户配置（含API Key加密存储）
│
├── resources/               # 资源文件
│   ├── icons/               # 图标资源
│   ├── styles/              # 样式文件（如QSS）
│   └── fonts/               # 字体文件（可选）
│
└── build/                   # 打包相关
    ├── build.spec           # PyInstaller配置
    └── installer/           # 安装包脚本（可选）
```

---

## 七、开发计划（建议）

| 阶段 | 任务 | 预计时间 |
|-----|------|---------|
| 第一阶段 | 题库管理（增删改查）+ 数据存储 | 2-3天 |
| 第二阶段 | 手动/批量导入题目 | 1-2天 |
| 第三阶段 | 组卷功能（随机抽题） | 1-2天 |
| 第四阶段 | 答题界面 + 自动评分 | 2-3天 |
| 第五阶段 | AI 智能生成题目 | 2-3天 |
| 第六阶段 | 优化与测试 | 1-2天 |
| 第七阶段 | 打包为 exe 可执行文件 | 1天 |

---

## 八、打包发布说明

### 8.1 打包工具选择

| 工具 | 优点 | 缺点 |
|-----|------|------|
| **PyInstaller** | 成熟稳定、文档丰富、易于使用 | 打包体积较大 |

### 8.2 打包命令示例（PyInstaller）

```bash
# 单文件打包
pyinstaller --onefile --windowed --icon=resources/icons/app.ico main.py

# 带资源文件打包
pyinstaller --onedir --windowed --add-data "resources;resources" --add-data "data;data" main.py
```

### 8.3 注意事项

- 确保所有依赖都已正确安装
- 资源文件（图标、样式等）需要正确打包
- 首次运行时自动创建 data 目录
- API Key 等敏感信息需加密存储
